
(function() {
        
            function getPageContext() {
                return Zenoss.env.device_uid || Zenoss.env.PARENT_CONTEXT;
            }
        
            Ext.ComponentMgr.onAvailable('component-add-menu', function(config) {
                var menuButton = Ext.getCmp('component-add-menu');
                menuButton.menuItems.push({
                    xtype: 'menuitem',
                    text: _t('Add NRPE Check') + '...',
                    hidden: Zenoss.Security.doesNotHavePermission('Manage Device'),
                    handler: function() {
                        var win = new Zenoss.dialog.CloseDialog({
                            width: 300,
                            title: _t('Add NRPE Check'),
                            items: [{
                                xtype: 'form',
                                buttonAlign: 'left',
                                monitorValid: true,
                                labelAlign: 'top',
                                footerStyle: 'padding-left: 0',
                                border: false,
                                items:                         [
                            {
                                fieldLabel: 'Title', 
                                allowBlank: 'false', 
                                name: 'title', 
                                width: 260, 
                                id: 'titleField', 
                                xtype: 'textfield'
                            }, 
                            {
                                fieldLabel: 'NRPE Command', 
                                allowBlank: 'false', 
                                name: 'nrpe_cmd', 
                                width: 260, 
                                id: 'nrpe_cmdField', 
                                xtype: 'textfield'
                            },
                            {
                                fieldLabel: 'NRPE Arguments',
                                allowBlank: 'true',
                                name: 'nrpe_args',
                                width: 260,
                                id: 'nrpe_argsField',
                                xtype: 'textfield'
                            },
                            {
                                fieldLabel: 'NRPE Timeout',
                                allowBlank: 'false',
                                name: 'nrpe_timeout',
                                width: 260,
                                id: 'nrpe_timeoutField',
                                value: 30,
                                xtype: 'numberfield',
                                minValue: 10,
                                maxValue: 60
                            },
                            {
                                fieldLabel: 'NRPE Minimum Threshold Value',
                                allowBlank: 'false',
                                name: 'nrpe_min',
                                width: 260,
                                id: 'nrpe_minField',
                                xtype: 'numberfield'
                            },
                            {
                                fieldLabel: 'NRPE Maximum Threshold Value',
                                allowBlank: 'false',
                                name: 'nrpe_max',
                                width: 260,
                                id: 'nrpe_maxField',
                                xtype: 'numberfield'
                            },
                            {
                                fieldLabel: 'Graph Point',
                                allowBlank: 'false',
                                name: 'nrpe_graphpoint',
                                width: 260,
                                id: 'nrpe_graphpointField',
                                xtype: 'textfield',
                                value: 'Errors'
                            }
                        ],
                                buttons: [{
                                    xtype: 'DialogButton',
                                    id: 'nrpeComponent-submit',
                                    text: _t('Add'),
                                    formBind: true,
                                    handler: function(b) {
                                        var form = b.ownerCt.ownerCt.getForm();
                                        var opts = form.getFieldValues();
                                        Zenoss.Secure-24.Check_NRPE.nrpeComponent.manage_addComponent(opts,
                                        function(response) {
                                            if (response.success) {
                                                new Zenoss.dialog.SimpleMessageDialog({
                                                    title: _t('NRPE Check Added'),
                                                    message: response.msg,
                                                    buttons: [{
                                                        xtype: 'DialogButton',
                                                        text: _t('OK'),
                                                        handler: function() { 
                                                            window.top.location.reload();
                                                            }
                                                        }]
                                                }).show();
                                            }
                                            else {
                                                new Zenoss.dialog.SimpleMessageDialog({
                                                    message: response.msg,
                                                    buttons: [{
                                                        xtype: 'DialogButton',
                                                        text: _t('OK'),
                                                        handler: function() { 
                                                            window.top.location.reload();
                                                            }
                                                        }]
                                                }).show();
                                            }
                                        });
                                    }
                                }, Zenoss.dialog.CANCEL]
                            }]
                        });
                        win.show();
                    }
                });
            });
        }()
);


